FROM repoweb-microsrv.intra.fazenda.sp.gov.br:5000/dotnet/aspnet:3.1-alpine
ARG user
ARG keytab
ARG appname
WORKDIR /var/api/$appname
EXPOSE 80
EXPOSE 443
RUN https_proxy=http://proxyservidores.lbintra.fazenda.sp.gov.br:8080 apk add icu-libs krb5

COPY . .
COPY krb5.conf /etc/krb5.conf
#Inicia ticket de autenticação Kerberos
RUN kinit $user -k -t $keytab
ENV DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=false
ENTRYPOINT ["dotnet", "$appname.dll"]