FROM repoweb-microsrv.intra.fazenda.sp.gov.br:5000/dotnet/aspnet:3.1-alpine
ARG user
ARG pass
#ARG keytab

WORKDIR /var/api/modelo_core_webapi
EXPOSE 80
EXPOSE 443
RUN https_proxy=http://proxyservidores.lbintra.fazenda.sp.gov.br:8080 apk add icu-libs krb5

COPY . .
COPY krb5.conf /etc/krb5.conf
#Inicia ticket de autenticação Kerberos
# não funcionou a parametrizacao: RUN kinit $user -k -t $keytab
#RUN kinit cs_sitecia_dev -k -t cs_sitecia_dev.keytab

RUN echo "$pass" |kinit $user@INTRA.FAZENDA.SP.GOV.BR

ENV DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=false
ENTRYPOINT ["dotnet", "modelo_core_webapi.dll"]